<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Push-Up Reports</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#060b14;
  --card:#0f1d34;
  --border:rgba(255,255,255,.08);
  --text:#e6eefc;
  --muted:#9fb0d0;
  --green:#31d07c;
  --amber:#f5b942;
  --blue:#2b66ff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:radial-gradient(1200px 600px at 50% -200px,#101a30 0%,var(--bg) 55%);
  color:var(--text);
}
header{
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
}
h1,h2{margin:0 0 10px}
button{
  background:var(--blue);
  color:#fff;
  border:none;
  border-radius:14px;
  padding:10px 14px;
  cursor:pointer;
}
.grid{
  padding:16px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}
.card{
  background:linear-gradient(180deg,#0f1d34,#0b1527);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}
.label{
  color:var(--muted);
  font-size:12px;
  letter-spacing:.08em;
}
.value{
  margin-top:10px;
  font-size:36px;
  font-weight:800;
  color:var(--green);
}
.valueSmall{
  margin-top:6px;
  font-size:18px;
  font-weight:700;
}
.section{padding:16px}
canvas{
  width:100%;
  background:linear-gradient(180deg,#0b1426,#070c17);
  border-radius:18px;
  border:1px solid var(--border);
}
footer{
  padding:10px 16px;
  color:var(--muted);
  font-size:12px;
}
</style>
</head>

<body>

<header>
  <div>
    <h1>Reports & Stats</h1>
    <div style="color:var(--muted)">Live â€¢ Read-only</div>
  </div>
  <button onclick="loadData()">ðŸ”„ Refresh</button>
</header>

<section class="grid">
  <div class="card"><div class="label">TOTAL REPS</div><div class="value" id="totalReps">â€”</div></div>
  <div class="card"><div class="label">WORKOUTS</div><div class="value" id="workouts">â€”</div></div>
  <div class="card"><div class="label">AVG / SESSION</div><div class="value" id="avgSession">â€”</div></div>
  <div class="card"><div class="label">BEST SESSION</div><div class="value" id="bestSession">â€”</div></div>
</section>

<section class="grid">
  <div class="card"><div class="label">BEST DAY</div><div class="valueSmall" id="bestDay">â€”</div></div>
  <div class="card"><div class="label">BEST WEEK</div><div class="valueSmall" id="bestWeek">â€”</div></div>
  <div class="card"><div class="label">BEST MONTH</div><div class="valueSmall" id="bestMonth">â€”</div></div>
  <div class="card"><div class="label">STREAK (DAYS)</div><div class="valueSmall" id="streak">â€”</div></div>
</section>

<section class="section">
  <h2>Weekly Volume Trend</h2>
  <select onchange="weeksWindow=this.value;drawTrend()" style="margin-bottom:10px">
    <option value="4">Last 4 weeks</option>
    <option value="8">Last 8 weeks</option>
    <option value="12" selected>Last 12 weeks</option>
  </select>
  <canvas id="trend" height="260"></canvas>
</section>

<footer id="status">Idle</footer>

<script>
const DATA_URL="https://script.google.com/macros/s/AKfycbxCYLXUKDsKNGhHUQzh_135yHk0j5lZ9JJZdJpxGiOEu66HndjWqQMWRBd7XZBIpCec/exec";
let data=[],weeksWindow=12,weeklyCache={};

function loadData(){
 fetch(DATA_URL+"?t="+Date.now())
 .then(r=>r.json())
 .then(j=>{data=j;render();});
}

function render(){
 const total=data.reduce((s,r)=>s+r.reps,0);
 document.getElementById("totalReps").textContent=total;
 document.getElementById("workouts").textContent=data.length;
 document.getElementById("avgSession").textContent=(total/data.length||0).toFixed(1);
 document.getElementById("bestSession").textContent=Math.max(...data.map(r=>r.reps),0);

 const byDay={},byWeek={},byMonth={};
 data.forEach(r=>{
  byDay[r.date]=(byDay[r.date]||0)+r.reps;

  const d=new Date(r.date+"T00:00:00");
  d.setDate(d.getDate()-(d.getDay()+6)%7); // Monday
  const w=d.toISOString().slice(0,10);
  byWeek[w]=(byWeek[w]||0)+r.reps;

  const m=r.date.slice(0,7);
  byMonth[m]=(byMonth[m]||0)+r.reps;
 });

 weeklyCache=byWeek;

 document.getElementById("bestDay").textContent=Math.max(...Object.values(byDay));
 document.getElementById("bestWeek").textContent=Math.max(...Object.values(byWeek));
 document.getElementById("bestMonth").textContent=Math.max(...Object.values(byMonth));

 drawTrend();
 document.getElementById("status").textContent="Updated";
}

function drawTrend(){
 const canvas=document.getElementById("trend");
 const ctx=canvas.getContext("2d");
 ctx.clearRect(0,0,canvas.width,canvas.height);

 const entries=Object.entries(weeklyCache)
   .sort((a,b)=>a[0].localeCompare(b[0]))
   .slice(-weeksWindow);

 if(entries.length<2)return;

 const vals=entries.map(e=>e[1]);
 const labels=entries.map(e=>{
   const d=new Date(e[0]);
   const onejan=new Date(d.getFullYear(),0,1);
   const week=Math.ceil((((d-onejan)/86400000)+onejan.getDay()+1)/7);
   return "W"+week;
 });

 const improving=vals[vals.length-1]>=vals[0];
 const color=improving?"#31d07c":"#f5b942";

 const max=Math.max(...vals),min=Math.min(...vals);
 const pad=32;
 const w=canvas.width-pad*2;
 const h=canvas.height-pad*2;

 // baseline
 ctx.strokeStyle="rgba(255,255,255,.08)";
 ctx.beginPath();
 ctx.moveTo(pad,pad+h);
 ctx.lineTo(pad+w,pad+h);
 ctx.stroke();

 // line
 ctx.strokeStyle=color;
 ctx.lineWidth=3;
 ctx.lineJoin="round";
 ctx.lineCap="round";
 ctx.beginPath();

 vals.forEach((v,i)=>{
   const x=pad+(i/(vals.length-1))*w;
   const y=pad+h-((v-min)/(max-min||1))*h;
   i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
 });
 ctx.stroke();

 // points + labels
 ctx.fillStyle=color;
 ctx.font="12px system-ui";
 ctx.textAlign="center";

 vals.forEach((v,i)=>{
   const x=pad+(i/(vals.length-1))*w;
   const y=pad+h-((v-min)/(max-min||1))*h;
   ctx.beginPath();
   ctx.arc(x,y,4,0,Math.PI*2);
   ctx.fill();
   ctx.fillText(labels[i],x,pad+h+18);
 });
}

loadData();
</script>
</body>
</html>
