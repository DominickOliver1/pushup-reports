<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Push-Up Stats</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg1:#2b0a3d;
  --bg2:#0b0f2a;
  --card:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12);
  --text:#f3f6ff;
  --muted:#b6b9ff;
  --pink:#ff5fd8;
  --violet:#8a7dff;
  --cyan:#3cf2ff;
  --green:#31d07c;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:
    radial-gradient(600px 300px at 20% 10%,#5d1f8b 0%,transparent 60%),
    radial-gradient(600px 300px at 80% 0%,#1a6cff 0%,transparent 55%),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
}
header{
  padding:22px;
  text-align:center;
}
h1{margin:0;font-size:28px}
.sub{color:var(--muted);font-size:13px;margin-top:6px}
button{
  margin:6px;
  background:linear-gradient(135deg,var(--pink),var(--violet));
  color:#fff;
  border:none;
  border-radius:16px;
  padding:10px 16px;
  font-weight:600;
  box-shadow:0 0 20px rgba(255,95,216,.45);
  cursor:pointer;
}
.section{padding:0 16px;margin-top:26px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:16px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:22px;
  padding:18px;
  backdrop-filter:blur(14px);
  box-shadow:
    0 0 0 1px rgba(255,255,255,.03),
    0 20px 40px rgba(0,0,0,.6),
    inset 0 0 40px rgba(255,255,255,.04);
}
.label{font-size:11px;letter-spacing:.18em;color:var(--muted)}
.value{
  margin-top:10px;
  font-size:34px;
  font-weight:800;
  background:linear-gradient(90deg,var(--pink),var(--cyan));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
canvas{
  width:100%;
  border-radius:22px;
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.25));
  border:1px solid var(--border);
  box-shadow:0 0 40px rgba(138,125,255,.25);
}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}
.day{
  height:64px;
  border-radius:16px;
  background:rgba(255,255,255,.05);
  border:1px solid var(--border);
  padding:6px;
  position:relative;
}
.day .num{font-size:11px;color:var(--muted)}
.day .sum{position:absolute;right:6px;bottom:6px;font-weight:700}
footer{
  margin:26px 16px;
  color:var(--muted);
  font-size:12px;
  text-align:center;
}
</style>
</head>

<body>

<header>
  <h1>Stats</h1>
  <div class="sub">Live â€¢ Google Sheets Powered</div>
  <button onclick="loadData()">Refresh</button>
</header>

<section class="section grid">
  <div class="card"><div class="label">TOTAL REPS</div><div class="value" id="totalReps">â€”</div></div>
  <div class="card"><div class="label">WORKOUTS</div><div class="value" id="workouts">â€”</div></div>
  <div class="card"><div class="label">BEST DAY</div><div class="value" id="bestDay">â€”</div></div>
  <div class="card"><div class="label">BEST WEEK</div><div class="value" id="bestWeek">â€”</div></div>
</section>

<section class="section">
  <h2>Performance</h2>
  <canvas id="chart" height="260"></canvas>
</section>

<section class="section">
  <h2>Calendar</h2>
  <div class="calendar" id="calendar"></div>
</section>

<footer id="status">Waiting for dataâ€¦</footer>

<script>
const DATA_URL="https://script.google.com/macros/s/AKfycbxCYLXUKDsKNGhHUQzh_135yHk0j5lZ9JJZdJpxGiOEu66HndjWqQMWRBd7XZBIpCec/exec";
let data=[];

/* ðŸ”’ NORMALIZATION LAYER â€” DO NOT REMOVE */
function normalizeRows(raw){
  if(!raw || !raw.length) return [];

  if(Array.isArray(raw[0])){
    return raw.map(r=>({
      date:String(r[0]).slice(0,10),
      reps:Number(r[1])||0
    }));
  }

  if(typeof raw[0]==="object"){
    return raw.map(r=>{
      const dk=Object.keys(r).find(k=>k.toLowerCase().includes("date"));
      const rk=Object.keys(r).find(k=>k.toLowerCase().includes("rep"));
      return{
        date:String(r[dk]).slice(0,10),
        reps:Number(r[rk])||0
      };
    });
  }
  return [];
}

function loadData(){
 fetch(DATA_URL+"?t="+Date.now())
  .then(r=>r.json())
  .then(raw=>{
    data=normalizeRows(raw);
    render();
  })
  .catch(()=>status.textContent="Failed to load data");
}

function render(){
 const byDay={},byWeek={};

 data.forEach(r=>{
  byDay[r.date]=(byDay[r.date]||0)+r.reps;
  const d=new Date(r.date+"T00:00");
  d.setDate(d.getDate()-(d.getDay()+6)%7);
  const w=d.toISOString().slice(0,10);
  byWeek[w]=(byWeek[w]||0)+r.reps;
 });

 totalReps.textContent=data.reduce((s,r)=>s+r.reps,0);
 workouts.textContent=data.length;
 bestDay.textContent=Math.max(...Object.values(byDay));
 bestWeek.textContent=Math.max(...Object.values(byWeek));

 drawChart(byDay);
 renderCalendar(byDay);
 status.textContent="Data loaded âœ“";
}

function drawChart(byDay){
 const c=chart,ctx=c.getContext("2d");
 c.width=c.clientWidth;c.height=260;
 ctx.clearRect(0,0,c.width,c.height);

 const entries=Object.entries(byDay).sort().slice(-30);
 if(entries.length<2) return;

 const vals=entries.map(e=>e[1]);
 const max=Math.max(...vals),min=Math.min(...vals);
 const pad=28,w=c.width-pad*2,h=c.height-pad*2;

 const grad=ctx.createLinearGradient(0,pad+h,0,pad);
 grad.addColorStop(0,"#ff5fd8");
 grad.addColorStop(.5,"#8a7dff");
 grad.addColorStop(1,"#3cf2ff");

 ctx.strokeStyle=grad;
 ctx.lineWidth=4;
 ctx.shadowColor="#8a7dff";
 ctx.shadowBlur=18;
 ctx.beginPath();

 vals.forEach((v,i)=>{
  const x=pad+(i/(vals.length-1))*w;
  const y=pad+h-((v-min)/(max-min||1))*h;
  i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.stroke();

 ctx.shadowBlur=0;
 ctx.lineTo(pad+w,pad+h);
 ctx.lineTo(pad,pad+h);
 ctx.closePath();
 ctx.globalAlpha=.18;
 ctx.fillStyle=grad;
 ctx.fill();
 ctx.globalAlpha=1;
}

function renderCalendar(byDay){
 calendar.innerHTML="";
 const now=new Date(),y=now.getFullYear(),m=now.getMonth();
 const days=new Date(y,m+1,0).getDate();

 for(let i=1;i<=days;i++){
  const iso=`${y}-${String(m+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;
  const v=byDay[iso]||0;
  const d=document.createElement("div");
  d.className="day";
  d.style.background=`rgba(138,125,255,${Math.min(v/100,.6)})`;
  d.innerHTML=`<div class="num">${i}</div><div class="sum">${v||""}</div>`;
  calendar.appendChild(d);
 }
}

loadData();
</script>
</body>
</html>
