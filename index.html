<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Push-Up Reports</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#060b14;
  --panel:#0c1424;
  --card:#0f1d34;
  --border:rgba(255,255,255,.08);
  --text:#e6eefc;
  --muted:#9fb0d0;
  --green:#31d07c;
  --blue:#2b66ff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:radial-gradient(1200px 600px at 50% -200px,#101a30 0%,var(--bg) 55%);
  color:var(--text);
}
header{
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
}
h1{margin:0;font-size:26px}
button{
  background:var(--blue);
  color:#fff;
  border:none;
  border-radius:14px;
  padding:10px 14px;
  cursor:pointer;
}
.grid{
  padding:16px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}
.card{
  background:linear-gradient(180deg,#0f1d34,#0b1527);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}
.label{
  color:var(--muted);
  font-size:12px;
  letter-spacing:.08em;
}
.value{
  margin-top:10px;
  font-size:36px;
  font-weight:800;
  color:var(--green);
}
.valueSmall{
  margin-top:6px;
  font-size:18px;
  font-weight:700;
}
.section{
  padding:16px;
}
canvas{
  width:100%;
  background:linear-gradient(180deg,#0b1426,#070c17);
  border-radius:18px;
  border:1px solid var(--border);
}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:10px;
}
.day{
  height:70px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#0a1222;
  position:relative;
  padding:8px;
}
.day .num{
  font-size:12px;
  color:var(--muted);
}
.day .sum{
  position:absolute;
  right:8px;
  bottom:8px;
  font-weight:800;
}
footer{
  padding:10px 16px;
  color:var(--muted);
  font-size:12px;
}
</style>
</head>

<body>

<header>
  <div>
    <h1>Reports & Stats</h1>
    <div style="color:var(--muted)">Read-only â€¢ Live from Google Sheets</div>
  </div>
  <button onclick="loadData()">ðŸ”„ Refresh</button>
</header>

<section class="grid">
  <div class="card"><div class="label">TOTAL REPS</div><div class="value" id="totalReps">â€”</div></div>
  <div class="card"><div class="label">WORKOUTS</div><div class="value" id="workouts">â€”</div></div>
  <div class="card"><div class="label">AVG / SESSION</div><div class="value" id="avgSession">â€”</div></div>
  <div class="card"><div class="label">BEST SESSION</div><div class="value" id="bestSession">â€”</div></div>
</section>

<section class="grid">
  <div class="card"><div class="label">BEST DAY</div><div class="valueSmall" id="bestDay">â€”</div></div>
  <div class="card"><div class="label">BEST WEEK</div><div class="valueSmall" id="bestWeek">â€”</div></div>
  <div class="card"><div class="label">BEST MONTH</div><div class="valueSmall" id="bestMonth">â€”</div></div>
  <div class="card"><div class="label">STREAK (DAYS)</div><div class="valueSmall" id="streak">â€”</div></div>
</section>

<section class="section">
  <h2>Weekly Volume Trend</h2>
  <select onchange="weeksWindow=this.value;drawTrend()" style="margin-bottom:10px">
    <option value="4">Last 4 weeks</option>
    <option value="8">Last 8 weeks</option>
    <option value="12" selected>Last 12 weeks</option>
  </select>
  <canvas id="trend" height="240"></canvas>
</section>

<section class="section">
  <h2>Calendar</h2>
  <div class="calendar" id="calendar"></div>
</section>

<footer id="status">Idle</footer>

<script>
const DATA_URL="https://script.google.com/macros/s/AKfycbxCYLXUKDsKNGhHUQzh_135yHk0j5lZ9JJZdJpxGiOEu66HndjWqQMWRBd7XZBIpCec/exec";
let data=[],weeksWindow=12;

function loadData(){
 fetch(DATA_URL+"?t="+Date.now())
 .then(r=>r.json())
 .then(j=>{data=j;render();});
}

function render(){
 const total=data.reduce((s,r)=>s+r.reps,0);
 document.getElementById("totalReps").textContent=total;
 document.getElementById("workouts").textContent=data.length;
 document.getElementById("avgSession").textContent=(total/data.length||0).toFixed(1);
 document.getElementById("bestSession").textContent=Math.max(...data.map(r=>r.reps),0);

 const byDay={},byWeek={},byMonth={};
 data.forEach(r=>{
  byDay[r.date]=(byDay[r.date]||0)+r.reps;
  const d=new Date(r.date+"T00:00:00");
  d.setDate(d.getDate()-(d.getDay()+6)%7);
  const w=d.toISOString().slice(0,10);
  byWeek[w]=(byWeek[w]||0)+r.reps;
  const m=r.date.slice(0,7);
  byMonth[m]=(byMonth[m]||0)+r.reps;
 });

 document.getElementById("bestDay").textContent=Math.max(...Object.values(byDay));
 document.getElementById("bestWeek").textContent=Math.max(...Object.values(byWeek));
 document.getElementById("bestMonth").textContent=Math.max(...Object.values(byMonth));

 drawTrend(byWeek);
 drawCalendar(byDay);
 document.getElementById("status").textContent="Updated";
}

function drawTrend(byWeek){
 const canvas=document.getElementById("trend");
 const ctx=canvas.getContext("2d");
 ctx.clearRect(0,0,canvas.width,canvas.height);

 const entries=Object.entries(byWeek)
   .sort((a,b)=>a[0].localeCompare(b[0]))
   .slice(-weeksWindow);

 if(entries.length<2)return;

 const vals=entries.map(e=>e[1]);
 const max=Math.max(...vals);
 const min=Math.min(...vals);

 const pad=24;
 const w=canvas.width-pad*2;
 const h=canvas.height-pad*2;

 ctx.strokeStyle="rgba(255,255,255,.08)";
 ctx.beginPath();
 ctx.moveTo(pad,pad+h);
 ctx.lineTo(pad+w,pad+h);
 ctx.stroke();

 ctx.strokeStyle="#31d07c";
 ctx.lineWidth=3;
 ctx.lineJoin="round";
 ctx.lineCap="round";
 ctx.beginPath();

 vals.forEach((v,i)=>{
   const x=pad+(i/(vals.length-1))*w;
   const y=pad+h-((v-min)/(max-min||1))*h;
   i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
 });
 ctx.stroke();

 ctx.fillStyle="#31d07c";
 vals.forEach((v,i)=>{
   const x=pad+(i/(vals.length-1))*w;
   const y=pad+h-((v-min)/(max-min||1))*h;
   ctx.beginPath();
   ctx.arc(x,y,4,0,Math.PI*2);
   ctx.fill();
 });
}

function drawCalendar(byDay){
 const cal=document.getElementById("calendar");
 cal.innerHTML="";
 const today=new Date();
 const y=today.getFullYear(),m=today.getMonth();
 const days=new Date(y,m+1,0).getDate();
 for(let i=1;i<=days;i++){
   const iso=`${y}-${String(m+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;
   const v=byDay[iso]||0;
   const intensity=Math.min(v/100,1);
   const d=document.createElement("div");
   d.className="day";
   d.style.background=`rgba(49,208,124,${intensity*0.45})`;
   d.innerHTML=`<div class="num">${i}</div><div class="sum">${v||""}</div>`;
   cal.appendChild(d);
 }
}

loadData();
</script>
</body>
</html>
